<!DOCTYPE html>
<html>
<head lang="zh-CN">  
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title></title>
	<style type="text/css">
	html,body{
		margin: 0;
		width: 100%;
		height: 100%;
	}

	#top{
		width: 100%;
		height: 20%;
	}

	#container{
		width: 100%;
		height: 100%;
	}
	</style>
</head>
<body>
<!-- <div id="top">
	<input type="text" />

</div> -->
<div id="container"></div>
<div id="panel"></div>

<script type="text/javascript" src="http://webapi.amap.com/maps?v=1.3&key=4ff74373fa23e9e2c687e453ba55fbdf"></script>
<script type="text/javascript">
	var lineArr = [["120.357918","31.589354"],["120.358368","31.589306"],["120.358124","31.588676"],["120.357521","31.58885"],["120.357407","31.588493"],["120.357361","31.58836"],["120.357086","31.588432"],["120.356369","31.588619"],["120.355606","31.588799"],["120.355469","31.588758"],["120.355225","31.588085"],["120.355019","31.587496"],["120.354828","31.586992"],["120.354126","31.585274"],["120.354065","31.585135"],["120.353615","31.583916"],["120.353508","31.583637"],["120.353279","31.583004"],["120.353256","31.582956"],["120.353111","31.582535"],["120.352936","31.582062"],["120.35276","31.581524"],["120.352547","31.58095"],["120.351913","31.579279"],["120.35186","31.579189"],["120.350983","31.577049"],["120.35054","31.576012"],["120.349968","31.574509"],["120.349319","31.574579"],["120.348831","31.574671"],["120.348488","31.574766"],["120.348297","31.574827"],["120.347946","31.574957"],["120.34594","31.575821"],["120.345802","31.575842"],["120.345329","31.576015"],["120.345192","31.576063"],["120.344749","31.576216"],["120.344513","31.576277"],["120.344254","31.576324"],["120.343903","31.576372"],["120.343506","31.576363"],["120.343193","31.576328"],["120.342957","31.576294"],["120.342621","31.576206"],["120.342445","31.576145"],["120.342224","31.576056"],["120.342117","31.576002"],["120.341927","31.575899"],["120.341789","31.575846"],["120.341103","31.575413"],["120.340767","31.575209"],["120.340591","31.575113"],["120.34034","31.574987"],["120.340279","31.574944"],["120.340218","31.574909"],["120.340057","31.574844"],["120.339806","31.574743"],["120.339043","31.574518"],["120.338783","31.574432"],["120.338631","31.574362"],["120.338516","31.574301"],["120.338379","31.574205"],["120.33831","31.574144"],["120.338264","31.574093"],["120.338196","31.574001"],["120.338104","31.57382"],["120.338074","31.573641"],["120.338074","31.573542"]];

	var lineArr1 = [["120.338074","31.573542"],["120.338089","31.573463"],["120.33812","31.573347"],["120.338158","31.573246"],["120.338211","31.573154"],["120.33828","31.573072"],["120.338417","31.572952"],["120.338593","31.572847"],["120.338707","31.572803"],["120.33889","31.572765"],["120.339066","31.572739"],["120.339378","31.572735"],["120.340248","31.572796"],["120.340714","31.572813"],["120.34108","31.57279"],["120.341232","31.57276"],["120.341347","31.572704"],["120.341393","31.572708"],["120.341476","31.572695"],["120.341896","31.572531"],["120.34201","31.572504"],["120.342865","31.572088"],["120.343361","31.571844"],["120.343765","31.571636"],["120.344116","31.571449"],["120.344337","31.57131"],["120.344612","31.571125"],["120.344826","31.570938"],["120.345207","31.570578"],["120.345436","31.570303"],["120.345802","31.56983"],["120.346062","31.569483"],["120.34639","31.569067"],["120.346596","31.568789"],["120.347305","31.567873"],["120.347481","31.567652"],["120.347908","31.567087"],["120.3489","31.56579"],["120.349159","31.565443"],["120.350845","31.563242"],["120.353004","31.560408"],["120.353836","31.559319"],["120.35614","31.556328"],["120.357529","31.554504"],["120.358505","31.553238"],["120.359268","31.552244"],["120.359566","31.551857"],["120.35984","31.551544"],["120.360588","31.550686"],["120.360977","31.550261"],["120.36145","31.549784"],["120.361809","31.549427"],["120.362206","31.549046"],["120.363388","31.547974"],["120.364517","31.54694"],["120.364899","31.546597"],["120.366219","31.545404"],["120.368538","31.543272"],["120.369934","31.542023"],["120.370438","31.54154"],["120.370712","31.541271"],["120.371132","31.540859"],["120.371445","31.540533"],["120.371872","31.540039"],["120.372223","31.539627"],["120.372719","31.539019"],["120.37291","31.538767"],["120.37323","31.538334"],["120.373505","31.537951"],["120.373817","31.537483"],["120.375717","31.534435"],["120.375938","31.534084"],["120.376633","31.532972"],["120.376976","31.532434"],["120.377029","31.532331"],["120.377327","31.531858"],["120.378052","31.530699"],["120.378441","31.5301"],["120.378731","31.529596"],["120.379547","31.52829"],["120.3797","31.528069"],["120.380051","31.527483"],["120.382713","31.523216"],["120.383087","31.522608"],["120.383423","31.522022"],["120.383591","31.521774"],["120.383781","31.521471"],["120.383904","31.52129"],["120.384216","31.520882"],["120.384598","31.520426"],["120.384758","31.520252"],["120.385033","31.519974"],["120.385399","31.519636"],["120.385765","31.51931"],["120.387932","31.517414"],["120.388145","31.517231"],["120.388908","31.516567"],["120.390396","31.515274"],["120.391556","31.514254"],["120.391861","31.513998"],["120.392029","31.513845"],["120.395393","31.510916"],["120.396545","31.509922"],["120.397278","31.50931"],["120.397476","31.508915"],["120.398003","31.508472"],["120.39843","31.508099"],["120.398857","31.507748"],["120.3993","31.507421"],["120.399719","31.507135"],["120.398621","31.506247"],["120.397758","31.505577"],["120.396591","31.504644"],["120.396339","31.504444"],["120.395897","31.504101"],["120.395775","31.503998"],["120.395035","31.503399"],["120.39312","31.501831"],["120.393211","31.501745"],["120.394218","31.500772"],["120.3937","31.500343"],["120.393318","31.500034"],["120.393044","31.499817"],["120.392914","31.499701"],["120.392365","31.499249"],["120.392288","31.49917"],["120.392082","31.499006"],["120.391769","31.498762"],["120.392113","31.498428"]];


	var map = new AMap.Map("container", {
        resizeEnable: true,
        zoom: 11
    });
    map.on("complete", completeEventHandler);

    // 地图图块加载完毕后执行函数
    var polyline, polyline, car;
    function completeEventHandler() {
        // 绘制轨迹(已走完)
        polyline = new AMap.Polyline({
            map: map,
            path: lineArr,
            strokeColor: "#f70d02",  //线颜色
            strokeOpacity: 1,     //线透明度
            strokeWeight: 4,      //线宽
            strokeStyle: "solid"  //线样式
        });

		// 绘制轨迹(剩余未走完)
        polyline1 = new AMap.Polyline({
            map: map,
            path: lineArr1,
            strokeColor: "#f70d02",  //线颜色
            strokeOpacity: 1,     //线透明度
            strokeWeight: 4,      //线宽
            strokeStyle: "dashed"  //线样式
        });

        // 地图小车初始化
        car = new AMap.Marker({
            map: map,
            position: ["120.338089","31.573463"],
            icon: "http://webapi.amap.com/images/car.png",
            offset: new AMap.Pixel(-26, -13),
            autoRotation: true
        });

        map.setFitView();
    }


     setInterval(function(){ 
    	//ajax取回一段坐标集
    	var timeArr = lineArr1.splice(0, 10+1);


    	if(timeArr.length != 0) {

    		lineArr = lineArr.concat(timeArr.slice(1));
    		lineArr1.unshift(timeArr[timeArr.length - 1]);

	    	// 修改已走完路线
	    	polyline.setPath(lineArr);

	    	// 修改未走完路线
	    	polyline1.setPath(lineArr1);

	    	// 计算经过路径距离
	    	var startPoint = timeArr[0];
	    	var endPoint = timeArr[timeArr.length-1];
	    	var startLngLat = new AMap.LngLat(startPoint.lng, startPoint.lat);
	    	var endLngLat = new AMap.LngLat(endPoint.lng, endPoint.lat);
	    	var distance = startLngLat.distance(endPoint);

	    	var sudu = distance / 1000 / 5 * 60 * 60;

	    	// 绘制小车行进路线
	    	car.moveAlong(timeArr, sudu);
    	}

    }, 5000); 
</script>
</body>
</html>